
<!-- saved from url=(0043) -->
<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# blog: http://ogp.me/ns/blog#">
<link rel='shortcut icon' href='/icons/famfamfam/mini/flag_red.gif'></link>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Ruby Resume</title>
<style>
body { margin:0;padding:0;background-color: rgb(246, 244, 241);}
pre {margin:0px 0px 0px 10px;}
code {
  margin:0px 0px 0px 10px;
  font-family: 'Consolas','Deja Vu Sans Mono','Bitstream Vera Sans Mono',monospace;
  font-size: 1.25em;
  letter-spacing: 0.015em;
  line-height: 1.55em;
  padding: 0.5em;
  border: 0px solid rgb(124, 124, 124);
  background-color: rgb(246, 244, 241);
}
.ccol tr td   { 
  border-left: 2px solid #AAA;
  vertical-align:top; 
  white-space: pre-wrap;
  width=50%;
  overflow: hidden ;
}
.col tr td  { 
  vertical-align:top; 
  white-space: pre-wrap;
  width:40%;
  word-wrapp:none;
  overflow: hidden ;
}
.cc {
  border-radius: 0px;
  font-size: 1.45em;
  line-height: 1.8em;
  color: #CCC;  
  background-color: #555;  
  text-transform : capitalize;
  border-bottom: 2px solid #066;
}
.c {
  margin:10px;
  padding-left : 20px;
  border-radius: 10px;
  font-size: 1.45em;
  line-height: 1.8em;
  color: #CCC;  
  background-color: #333;  
  text-transform : capitalize;
}
.c1 {
  margin:20px;
  padding-left : 20px;
  border-radius: 15px;
  font-size: 1.2em;
  line-height: 1.4em;
  color: #CCC;  
  background-color: #555;  
  text-transform : capitalize;
}
.ex {
  margin:5px 0 0 20px;
  padding-left : 20px;
  border-radius: 6px;
  font-size: 1.0em;
  line-height: 1.4em;
  color: #EEA;  
  background-color: #588;  
}
a { text-decoration:none; color: #444; }
a:link              { color:#444;text-decoration:none }
a:visited           { color:#644; }
a:hover             { color:#464;}
a:active            { color:#446;}
</style>
<script type="text/javascript" async="" src="./Ruby Resume_files/ga.js"></script><script src="./Ruby Resume_files/tumblelog.js"></script><style type="text/css" id="tumblr_teaser_follow_css">
#tumblr_teaser_follow {
display: block;
opacity: 1;
visibility: hidden;
position: fixed;
bottom: 0px;
right: 0px;
width: 1px;
height: 1px;
z-index: 2147483647;
}
#tumblr_teaser_follow.open {
visibility: visible;
width: 310px;
height: 110px;
}
</style><style type="text/css" id="tumblr_iframe_css">
.tumblr_controls {
position: absolute;
top: 0px;
right: 0px;
display: block;
opacity: 1;
width: 1px;
height: 1px;
z-index: 2147483647;
visibility: hidden;
pointer-events: none;
}
.tumblr_controls.visible {
visibility: visible;
pointer-events: all;
}
.tumblr_controls.sticky {
position: fixed;
}
.tumblr_controls.transition {
-webkit-transition: top 0.1s ease;
-moz-transition: top 0.1s ease;
-ms-transition: top 0.1s ease;
-o-transition: top 0.1s ease;
transition: top 0.1s ease;
}
iframe#tumblr_controls.tumblr_controls.sticky.transition {
-webkit-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
-moz-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
-ms-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
-o-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
top: 0 !important;
}
.tumblr_controls.sticky.transition {
-webkit-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
-moz-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
-ms-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
-o-animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
animation: tumblr_controls_fade_in 0.3s 0.2s linear 1 both;
top: 0 !important;
}
.tumblr_controls.flash_fix {
visibility: hidden !important;
}
body.mobile_bar {
-webkit-transition: padding-top 0.1s ease;
-moz-transition: padding-top 0.1s ease;
-ms-transition: padding-top 0.1s ease;
-o-transition: padding-top 0.1s ease;
transition: padding-top 0.1s ease;
padding-top: 44px;
}
@-webkit-keyframes tumblr_controls_fade_in {
0% {
opacity: 0;
}
100% {
opacity: 1;
}
}
@-moz-keyframes tumblr_controls_fade_in {
0% {
opacity: 0;
}
100% {
opacity: 1;
}
}
@-ms-keyframes tumblr_controls_fade_in {
0% {
opacity: 0;
}
100% {
opacity: 1;
}
}
@-o-keyframes tumblr_controls_fade_in {
0% {
opacity: 0;
}
100% {
opacity: 1;
}
}
@keyframes tumblr_controls_fade_in {
0% {
opacity: 0;
}
100% {
opacity: 1;
}
}
</style>

<link rel="stylesheet" type="text/css" href="./Ruby Resume_files/stylesheet.css">
<meta http-equiv="x-dns-prefetch-control" content="off">

<!-- BEGIN TUMBLR FACEBOOK OPENGRAPH TAGS --><!-- If you'd like to specify your own Open Graph tags, define the og:url and og:title tags in your theme's HTML. --><!-- Read more: http://ogp.me/ --><meta property="fb:app_id" content="48119224995"><meta property="og:site_name" content=""><meta property="og:title" content=""><meta property="og:url" content=""><meta property="og:determiner" content="a"><meta property="og:description" content=""><meta property="og:type" content="tumblr-feed:entry"><meta property="og:image" content="http://33.media.tumblr.com/avatar_e82f02b1a029_512.png"><meta property="al:ios:url" content="tumblr://x-callback-url/blog?blogName=raubarede&amp;postID="><meta property="al:ios:app_name" content="Tumblr"><meta property="al:ios:app_store_id" content="305343404"><meta property="al:android:url" content="tumblr://x-callback-url/blog?blogName=raubarede&amp;postID="><meta property="al:android:app_name" content="Tumblr"><meta property="al:android:package" content="com.tumblr"><!-- END TUMBLR FACEBOOK OPENGRAPH TAGS -->


<!-- TWITTER TAGS --><meta charset="utf-8"><meta name="twitter:card" content="summary"><meta name="twitter:description" content=""><meta name="twitter:url" content=""><meta name="twitter:site" content="tumblr"><meta name="twitter:app:name:iphone" content="Tumblr"><meta name="twitter:app:name:ipad" content="Tumblr"><meta name="twitter:app:name:googleplay" content="Tumblr"><meta name="twitter:app:id:iphone" content="305343404"><meta name="twitter:app:id:ipad" content="305343404"><meta name="twitter:app:id:googleplay" content="com.tumblr"><meta name="twitter:app:url:iphone" content="tumblr://x-callback-url/blog?blogName=raubarede&amp;postID=&amp;referrer=twitter-cards"><meta name="twitter:app:url:ipad" content="tumblr://x-callback-url/blog?blogName=raubarede&amp;postID=&amp;referrer=twitter-cards"><meta name="twitter:app:url:googleplay" content="tumblr://x-callback-url/blog?blogName=raubarede&amp;postID=&amp;referrer=twitter-cards">

</head>




<body>
<h2 class="cc"><center>Ruby mini-doc</center></h2>
From http://docs.opscode.com/just_enough_ruby_for_chef.html, completed
for my own vision ...<br>

<ul>
<a href="http://ruby.on-page.net/">Ruby one page documentation</a><br>
<a href="http://ruby-doc.org/">Ruby library documentation</a>
  (<a href="http://overapi.com/ruby">Summary</a>)<br>
<a href="http://overapi.com/static/cs/Ruby%20Language%20QuickRef.pdf">Pdf QuickRef</a><br>
<a href="http://www.java2s.com/Code/Ruby/CatalogRuby.htm">Snippets</a><br>
</ul>

<h3><center>Ruby is a Dynamic Object language, with closure, Threading and coroutine</center></h3>
<h1 class="cc"><center>Sommaire</center></h1>
<table><tbody><tr><td><a href="#c0">Run ruby</a></td><td></td></tr>
<tr><td><a href="#c1">assigning a variable:</a></td><td> <a href="#c2">splat operator</a>,  <a href="#c3">some basic arithmetic:</a>,  <a href="#c4">make a big number</a></td></tr>
<tr><td><a href="#c5">Strings</a></td><td></td></tr>
<tr><td><a href="#c6">Symboles</a></td><td></td></tr>
<tr><td><a href="#c7">Boolean</a></td><td></td></tr>
<tr><td><a href="#c8">Range</a></td><td></td></tr>
<tr><td><a href="#c9">Arrays</a></td><td></td></tr>
<tr><td><a href="#c10">arrays &lt;==&gt; String</a></td><td> <a href="#c11">format % [values]</a></td></tr>
<tr><td><a href="#c12">$#wqrx{} stuff</a></td><td></td></tr>
<tr><td><a href="#c13">Predefined Variables / Constantes</a></td><td> <a href="#c14">Predefined variables</a>,  <a href="#c15">Predefined Constantes</a></td></tr>
<tr><td><a href="#c16">Hash : dictionary</a></td><td></td></tr>
<tr><td><a href="#c17">Hash with default distinct value</a></td><td> <a href="#c18">list and count distinct words in a txt file</a></td></tr>
<tr><td><a href="#c19">Hash &lt;==&gt; Array</a></td><td></td></tr>
<tr><td><a href="#c20">regular expressions</a></td><td> <a href="#c21">Specs (from Rebular and Pickaxe)</a>,  <a href="#c22">Lookhead</a>,  <a href="#c23">Options /xxx/options</a>,  <a href="#c24">Extraction</a></td></tr>
<tr><td><a href="#c25">replace</a></td><td> <a href="#c26">Execute a system command and transform output</a></td></tr>
<tr><td><a href="#c27">defines a function, a method</a></td><td> <a href="#c28">Arguments</a></td></tr>
<tr><td><a href="#c29">BLOCK</a></td><td> <a href="#c30">block parameter/yield</a>,  <a href="#c31">explicit block parameter/explicit call</a>,  <a href="#c32">block object / block call</a></td></tr>
<tr><td><a href="#c33">conditionally with an if (or unless) statement</a></td><td> <a href="#c34">simple if</a>,  <a href="#c35">postfix if/unless (a la perl)</a></td></tr>
<tr><td><a href="#c36">case statement</a></td><td></td></tr>
<tr><td><a href="#c37">Looping</a></td><td> <a href="#c38">while statement</a>,  <a href="#c39">until statement</a>,  <a href="#c40">loop</a></td></tr>
<tr><td><a href="#c41">Thread</a></td><td></td></tr>
<tr><td><a href="#c42">Catch Exceptions</a></td><td> <a href="#c43">Exception and  StandardError</a>,  <a href="#c44">postfixe form</a>,  <a href="#c45">generate a exception</a>,  <a href="#c46">Thread and exception</a></td></tr>
<tr><td><a href="#c47">File / Directory access</a></td><td> <a href="#c48">File read</a>,  <a href="#c49">File write</a></td></tr>
<tr><td><a href="#c50">Execute process, get output</a></td><td> <a href="#c51">get output</a>,  <a href="#c52">get input for sending data to subprocess</a></td></tr>
<tr><td><a href="#c53">Socket</a></td><td> <a href="#c54">Socket TCP client</a>,  <a href="#c55">Socket TCP server</a>,  <a href="#c56">Socket UDP Send and Receive</a>,  <a href="#c57">Socket Multicast</a></td></tr>
<tr><td><a href="#c58">Serialisation</a></td><td></td></tr>
<tr><td><a href="#c59">Class</a></td><td></td></tr>
<tr><td><a href="#c60">Module</a></td><td></td></tr>
<tr><td><a href="#c61">Class : singleton, statics...</a></td><td></td></tr>
<tr><td><a href="#c62">Introspection 1</a></td><td> <a href="#c63">Introspection 1 :level class</a>,  <a href="#c64">Introspection 2 : level Instructions</a></td></tr>
<tr><td><a href="#c65">Meta programming</a></td><td> <a href="#c66">From a Hash, create a Class which each method gives access of members of the hash</a></td></tr>
<tr><td><a href="#c67">DSL with Ruby Bloc</a></td><td> <a href="#c68">Define a micro-test framework</a></td></tr>
<tr><td><a href="#c69">Ruby and Functional Programming</a></td><td> <a href="#c70">Principles</a>,  <a href="#c71">Closure</a>,  <a href="#c72">Examples from  onliner classical code</a>,  <a href="#c73">print methods which match a regexp of an object</a>,  <a href="#c74">print big line of ruby code in current directory</a>,  <a href="#c75">rotation of a polyline</a></td></tr>
<tr><td><a href="#c76">Source code sructure</a></td><td> <a href="#c77">includes</a>,  <a href="#c78">context : where is current instructions?</a>,  <a href="#c79">class scope</a>,  <a href="#c80">Here docs</a>,  <a href="#c81">source here doc</a></td></tr>
<tr><td><a href="#c82">the end...</a></td><td></td></tr></tbody></table>

<pre><code>

<a name="c0"></a><div class="c"> Run ruby                                                                                                                                                                                      </div>
$ ruby file.rb
$ ruby -e "puts 'CouCou'"
$ tasklist /v | ruby -ne "puts $_.split(/\s+/).join(',') if $_ =~ /ruby/i"
 ruby.exe,4752,Console,1
 ruby.exe,4832,Console,1
 ruby.exe,4284,Console,1
 ruby.exe,4220,Console,1
 
$ ruby -e "puts RUBY_VERSION"
$ ruby -e "def triple(n) n+n+n; end; p triple(ARGV[0].to_i)"  11
33


<a name="c1"></a><div class="c"> assigning a variable:                                                                                           </div>

x = 1

x,y= 1,2           # x=1 , y=2
a,b=b,a            # swap
a,b=b,nil          # put b in a and reset b

a=b=c=x            # x to all

a||={}             # if a is nil , set a empty Hash

<a name="c2"></a><div class="c1"> splat operator                                                                                            </div>

x,y= *[10,12,13]   # x=10, y=12
x,*y=*[1,2,3,4]    # x=1 , y=[2,3,4]
x,y,*z=*[1,2,3,4]  # x=1 , y=2 ; z=[3,4]

def sum(*args) args.inject(0) { |sum,v| sum+v } end
sum(1,2,3,4,5)    # 15

<a name="c3"></a><div class="c1"> some basic arithmetic:                                                                                           </div>
1 + 2           # =&gt; 3
5 / 2           # =&gt; 2   (because both arguments are whole numbers)
5 / 2.0         # =&gt; 2.5 (because one of the numbers had a decimal place)
1 + (2 * 3)     # =&gt; 7   (you can use parens to group expressions)
1000_000        # _ delimiter acceped in numeric literal
1000_000_000_000 # Ok; ruby know bignum, conversion to bignum are automatics

<a name="c4"></a><div class="ex"> make a big number                                                                                            </div>

# ruby automaticly mute int to bignum

def fact(n)
 fact=1
 1.upto(n &lt; 1 ? 1 : n) { |i| fact=fact*i }
 return(fact)
end
p fact 1000
4023872600770937735437024339230039857193
7486421071463254379991042993851239862902
0592044208486969404800479988610197196058
6316668729948085589013238296699445909974
2450408707375991882362772718873251977950
5950995276120874975462497043601418278094
....000000000000000000000000000000000000
0000000000000000000000000000000000000000
00000000

<a name="c5"></a><div class="c"> Strings                                                                                           </div>
'single quoted' # =&gt; "single quoted"
"double quoted" # =&gt; "double quoted"
'It\'s alive'   # =&gt; "It's alive!"
"1 + 2 = 5"     # =&gt; "1 + 2 = 5" (numbers surrounded by quotes may exhibit string-like behavior)

x = "Bob"
"Hi, #{ x }"      # =&gt; "Hi, Bob"
'Hello, #{ x }'   # =&gt; "Hello, \#{ x }" Notice that single quotes don't work with #{}

"\n".<b>size</b>       # 1    "" expand \n to LF, so One char 
'\n'.<b>size</b>       # 2    '' do not expand \.. , 2 char : '\' and 'n'

string.<b>upcase</b>
string.<b>downcase</b>
string.<b>capitalize</b>
string.<b>center</b>(len) # make a big string, str centered (blanc are padding left/right)
string.<b>center</b>(len,'-') # make a big string, str centered ('-' are padding left/right)
string.<b>ljust</b>(lenth)
string.<b>rjust</b>(lenth)
string.<b>strip</b>       # supress blancs characteres at start/end of sring
string.<b>lstrip</b>
string.<b>rstrip</b>
string.<b>chomp</b>       # supress \r,\n.. at end of the string, if exist
string[2..4]       # 2 to 4 char of string
string[-4..-1]     # 4 last chars
string[position,length]
string[1,2]               # 2 char from second position
string &lt;&lt; "az"            # append string to string !!!! String are not immutable!!!
"ab"+"bc"                 # 'abbc'
"ab"*10                   # "ababababababababab"

string.<b>each_line</b> {|line| line.<b>chomp</b>}

string.<b>encode</b>(encode) # change encoding, binaries values are changed
string.<b>force_encoding</b> # chenge the type marker, not the binary values

string.<b>end_with</b>?("end")
string.<b>empty</b>?
string.<b>include</b>?("data")
string.<b>insert</b>(position,value)

string.<b>to_i</b>
string.<b>to_s</b>
string.<b>hex</b>
"a".<b>ord</b>     # ascii value of one char string

string.<b>match</b>('pattern')
string.<b>match</b>(/pattern/)

<a name="c6"></a><div class="c"> Symboles                                                                                            </div>
# Returns the Symbol corresponding to str, creating the symbol 
# if it did not previously exist
string.<b>to_sym</b>
symbolt.<b>to_str</b>
(:eeee).class   # Symbol

# Symbols are unique

"abc".<b>to_sym</b>.object_id == ["a","b","c"].<b>join</b>.<b>to_sym</b>.object_id
"abc".<b>to_sym</b>.object_id == :abc.object_id 

<a name="c7"></a><div class="c"> Boolean                                                                                            </div>
true            # =&gt; true
false           # =&gt; false
nil             # =&gt; nil
1 == 1          # =&gt; true ( == tests for equality )
1 == true       # =&gt; false ( == tests for equality )

!true           # =&gt; false
!false          # =&gt; true
!nil            # =&gt; true
1 != 2          # =&gt; true (1 is not equal to 2)
1 != 1          # =&gt; false (1 is not not equal to itself)



<a name="c8"></a><div class="c"> Range                                                                                            </div>
('A'..'Z').<b>to_a</b>     # =&gt; ['A','B'...'Z']
('avs'..'bre').<b>to_a</b>     
# =&gt;  ["avs", "avt", "avu", "avv", "avw", ....   "bre"]
('A'..'Z').<b>each</b> {|c| p c}    
(10..40).<b>step</b>(10) { |n| p n }
10
20
30
40

(1..10).<b>member</b>?(1)  # true

# Ranges are lazy evaluation

(1..1000_000_000_000).<b>member</b>?(333) # true

<a name="c9"></a><div class="c"> Arrays                                                                                         </div>

x = ["a", "b", "c"] # =&gt; ["a", "b", "c"]
x[0]                # =&gt; "a" (zero is the first index)
x.<b>first</b>             # =&gt; "a" (see?)
x.<b>last</b>              # =&gt; "c"
x[-2..-1]           # =&gt; ["b", "c"]
x[1,2]              # =&gt; ["a',"b"]
x + ["d"]           # =&gt; ["a", "b", "c", "d"]
x                   # =&gt; ["a", "b", "c"] ( x is unchanged)
x &lt;&lt; 1              # =&gt; ["a", "b", "c",1]
x &lt;&lt; [1,2]          # =&gt; ["a", "b", "c",1,[1,2]]

array.<b>each</b> { |element| }
array.<b>reverse_each</b> { |element| }
array.<b>size</b>
array.<b>sort</b>
array.<b>sort</b> {|a,b| a &lt;=&gt; b } # specify comparaison
array.<b>sort</b> {|a,b| a[0] &lt;=&gt; b[0] } 
array.<b>shift</b>      # pop
array.<b>unshit</b>     # push
array &lt;&lt; element

see <a href="#array2">here</a> for many more...

<a name="c10"></a><div class="c"> arrays &lt;==&gt; String                                                                                           </div>

"a,b,c,d".<b>split</b>(',')          # ["a","b","c","d"]
["a","b","c","d"].<b>join</b>(",")   # "a,b,c,d"

"a,b,2,c,d,1".<b>scan</b>(/[\w]+/)          # ["a","b","c","d"]
"qsdf : fqsdf qdsf, gqsd".<b>scan</b>(/\w+/) # ["qsdf","fqsdf","qdsf","gqsd"]
"abcd bcde cd".<b>split</b>(/\s+/).<b>map</b> { |word| 
  word.<b>capitalize</b>}.<b>select</b> {|w| 
    w.<b>size</b>&gt;=3}.<b>join</b>(",")
  "Abcd,Bcde"
  
<a name="c11"></a><div class="c1"> format % [values]                                                                                             </div>

# format % operator : as C sprintf()
str= format % [data...]  ===  sprintf(str,format,data...)

Dir.<b>glob</b>("*.rb")[0..5].<b>each</b> { |name|
   puts "%-20s | %05d , %s" <b>%</b> [
      name,
      File.<b>size</b>(name),
      File.<b>mtime</b>(name).<b>to_s</b>
   ]
}
a.rb                 | 04353 , 2012-03-22 22:23:37 +0100
allways.rb           | 00698 , 2012-12-13 19:58:44 +0100
anac.rb              | 05777 , 2011-10-26 21:58:39 +0200
anar.rb              | 01316 , 2011-10-26 21:58:39 +0200
au3.rb               | 00046 , 2011-10-26 21:58:39 +0200
audio.rb             | 02607 , 2011-10-26 21:58:39 +0200

<a name="c12"></a><div class="c"> $#wqrx{} stuff                                           </div>
# front/end chars '{' and '}'  can be replaced by () [] || ...

"string #{ 2 }"          #   string 2
'string #{ 2 }'          #   string #{ 2 }
%q{string '#{ 2 }'}      #   string '#{ 2 }'
%Q{string '#{ 2 }'}      #  string '2'

%w{ aa bb cc }           #  ["aa","bb","cc"]
%w(aa b\ b)            #["aa", "b b"]
%w{aa bb #{ cc }}        #  ["aa","bb","#{ cc }"]
cc="ccc"
%W{ aa bb #{ cc } }        #  ["aa","bb","ccc"]

%i               #  [:aa, :bb, :cc]

%x{ cmd.exe /c dir }
a="c:/"
%X{ cmd.exe /c dir # }

%r{ regexp without accolades... }

<a name="c13"></a><div class="c"> Predefined Variables / Constantes                                           </div>
<a name="c14"></a><div class="c1"> Predefined variables                                           </div>

$!  The exception information message set by ‘raise’.
$@  Array of backtrace of the last exception thrown.
$&amp;  The string matched by the last successful pattern match in this scope.
$`  The string to the left of the last successful match.
$'  The string to the right of the last successful match.
$+  The last bracket matched by the last successful match.
$1  The Nth group of the last successful match. May be &gt; 1.
$~  The information about the last match in the current scope.
$=  The flag for case insensitive, nil by default.
$/  The input record separator, newline by default.
$\  The output record separator for the print and IO#write. Default is nil.
$,  The output field separator for the print and Array#join.
$;  The default separator for String#split.
$.  The current input line number of the last file that was read.
$&lt;  The virtual concatenation file of the files given on command line.
$&gt;  The default output for print, printf. $stdout by default.
$_  The last input line of string by gets or readline.
$0  Contains the name of the script being executed. May be assignable.
$*  Command line arguments given for the script sans args.
$$  The process number of the Ruby running this script.
$?  The status of the last executed child process.
$:  Load path for scripts and binary modules by load or require.
$"  The array contains the module names loaded by require.
$DEBUG      The status of the -d switch.
$FILENAME   Current input file from $&lt;. Same as $&lt;.filename.
$LOAD_PATH  Load path for scripts and binary modules by load or require (as $:).
$stderr     The current standard error output.
$stdin      The current standard input.
$stdout     The current standard output.
$VERBOSE    The verbose flag, which is set by the -v switch.
$-0         The alias to $


<a name="c15"></a><div class="c1"> Predefined Constantes                                           </div>

TRUE              The typical true value.
FALSE             The false itself.
NIL               The nil itself.
STDIN             The standard input. The default value for $stdin.
STDOUT            The standard output. The default value for $stdout.
STDERR            The standard error output. The default value for $stderr.
ENV               The hash contains current environment variables.
ARGF              The alias to the $&lt;.
ARGV              The alias to the $*.
DATA              The file object of the script, pointing just after __END__.
RUBY_VERSION      The ruby version string (VERSION was depricated).
RUBY_RELEASE_DATE The relase date string.
RUBY_PLATFORM     The platform identifier.

<a name="c16"></a><div class="c"> Hash : dictionary                                                                                           </div>
h=Hash.new        #{}
h=Hash[1,11,2,22] # {1=&gt;11, 2=&gt;22}
h = {
"first_name" =&gt; "Bob",
"last_name"  =&gt; "Jones"
}
# { "first_name =&gt; "Bob", "last_name" =&gt; "Jones" }
h = {
first_name: "Bob",
last_name:  "Jones"
}
# { :first_name =&gt; "Bob", :last_name =&gt; "Jones" }

h.<b>keys</b>              # =&gt; ["first_name", "last_name"]
h["first_name"]     # =&gt; "Bob"
h["last_name"]      # =&gt; "Jones"
h["age"] = 23
h.<b>keys</b>              # =&gt; ["first_name", "age", "last_name"]
h.<b>values</b>            # =&gt; ["Jones", "Bob", 23]

h.<b>size</b>  

# Hash, (from ruby 1.9) conserve creation order

h.<b>each</b>     { |key,value|}
h.<b>each_pair</b>{ |key,value|}
h.<b>each_key</b> { |key|}
h.<b>each_value</b>{ |value|}

h.<b>merge</b>(otherHash)
{a: 1,b: 2}.<b>merge</b>({b:3,c:4}) # =&gt;{:a=&gt;1, :b=&gt;3, :c=&gt;4}

h.<b>delete_if</b> { |k,v| k.<b>size</b>==2 &amp;&amp; v =~ /^a/}
h.<b>delete</b>(key)

<a name="c17"></a><div class="c"> Hash with default distinct value                                                                                           </div>

# Hash.<b>new</b>  : each time a entry is create bloc 
                    is evaluate for pre-initialisation 
                    of the entry

h=Hash.new() { |h,k| h[k]=[] }  # always initialize a entry with a empty array

Dir.<b>glob</b>("*.rb").<b>each</b> { |filename| 
  h[filename.<b>size</b>] &lt;&lt; [
      filename,
       File.<b>size</b>(filename)
  ]
}
p h
{4=&gt;
  [["a.rb", 4353],
   ["b.rb", 1109],
   ["y.rb", 4815]],
 10=&gt;
  [["allways.rb", 698],
   ["unicode.rb", 3776]],
 7=&gt;
  [["anac.rb", 5777],
   ["disq.rb", 144],
   ["game.rb", 6872],
   ....
   
<a name="c18"></a><div class="ex"> list and count distinct words in a txt file                                                                                           </div>


reserved=Hash[*(
 "which their said have will from when this were upon there then 
 came into come that shall unto they them with thou thee king hath
 ....
 whom good took thus bring word offering place more sent like again
 mine about heard time".
 split(/ +/).map {|w| [w,0]}.flatten
)]

dico=File.read('bibleEng.txt').
  split(/[^\w]+/).
  map {|word| word.downcase}.
  select { |word| word.upcase!=word.downcase}.
  tap {|l| puts "#{ l.size } words"}.
  inject(Hash.new { |h,k| h[k]=0}) { |h,word|
    h[word]+=1 if word.size&gt;3  &amp;&amp; !reserved[word]
    h 
  }
puts "#{ dico.size } real, unreserved words"
dico.sort {|a,b| b[1]&lt;=&gt;a[1]}[0..20].
  each { |k,v| puts "%20s %d" % [k,v]}

795073 words
12046 real, unreserved words
                lord 7971
              israel 2576
              people 2143
               house 2026
            children 1822
               saith 1262
               david 1139
              father 1126
                sons 1105
               earth 987
               great 962
               thine 937
                city 870
                days 868
             brought 864
              called 632
                evil 615
                holy 611
               egypt 611
             hundred 590
               spake 588


<a name="c19"></a><div class="c"> Hash &lt;==&gt; Array                                                                                           </div>

{1=&gt;1,2=&gt;2,3=&gt;3}.<b>to_a</b>        # [[1, 1], [2, 2], [3, 3]]
Hash[1,2,3,4]                # {1=&gt;2, 3=&gt;4}

x= ["a", "abc", "b", "bcd", "c", "cde"]
Hash[*x]                    # {"a"=&gt;"abc", "b"=&gt;"bcd", "c"=&gt;"cde"}

<a name="c20"></a><div class="c"> regular expressions                                                                                           </div>

"I believe"  =~ /I/                       # =&gt; 0 
"I believe"  =~ /i/i                      # =&gt; 0 
"I believe"  =~ /lie/                     # =&gt; 4 
"I am human" =~ /bacon/                   # =&gt; nil 
"I am human" !~ /bacon/                   # =&gt; true 
/give me a ([0-9]+)/ =~ "give me a 7"     # =&gt; 0 (matched)

<a name="c21"></a><div class="c1">Specs (from Rebular and Pickaxe)</div>

[abc] 	A single character of: a, b or c      [^abc] 	Any single character except: a, b, or c
[a-z] 	Any single character                  [a-zA-Z] 	Any single character in the range a-z or A-Z
^ 	Start of line                             $ 	End of line
\A 	Start of string                           \z 	End of string
. 	Any single character                      
\s 	Any whitespace character                  \S 	Any non-whitespace character
\d 	Any digit                                 \D 	Any non-digit
\w 	Any word character (a..zA..Z0..9_)        \W 	Any non-word character
\b 	Any word boundary       word ,word!.word:other
                            ^--^  ^--^  ^--^ ^---^

(...) 	Capture everything enclosed, can be restitute by \1 \2.. :

'&lt;div class="ddd"&gt;'.gsub(/class=(")([^"]+)(")/,'class =\'\2__\'')
=&gt; "&lt;div class ='ddd__'&gt;"

(a|b) 	a or b
(ab)|(cd) ab or cd

a? 	Zero or one of a             a* 	Zero or more of a
a+ 	One or more of a

a{ 3 } 	Exactly 3 of a           a{3,} 	3 or more of a 
a{3,6} 	Between 3 and 6 of a

<a name="c22"></a><div class="c1">Lookhead </div>
(?=re)       Matches re at this point, but does not consume
(?:re)       Makes re into a group without generating backreferences
(?=re)       Matches re at this point, but does not consume it :  'positive lookahead'
(?!re)       Matches if re does not match at this point.Does not consume the match  'negative lookahead'
(?&gt;re)       match without backtrack


<a name="c23"></a><div class="c1">Options /xxx/options </div>

Options:
i case insensitive           # "abc" /ABC/i ==&gt; 0 (match)
m make dot match newlines 
x ignore whitespace in regex 
o perform #{...} substitutions only once 

<a name="c24"></a><div class="c1">Extraction </div>
"aa213bb4234cc244" =~ /(a*)\d*(b*)\d*(c*)/ &amp;&amp; ($1+' '+$2+' '+$3)
=&gt; "aa bb cc"

"aa213bb4234cc244".scan(/[a-z]+/)
=&gt; ["aa", "bb", "cc"]

See <a href="http://www.rubular.com/">here: Rubular</a>

<a name="c25"></a><div class="c"> replace                                                                                           </div>
"abc".<b>gsub</b>(/.b./,"b")             # "b"
"axc".<b>gsub</b>(/a(.)c/,"'\1'")        #  'x'

"abc".<b>gsub</b>('b',"x")             # axc

<a name="c26"></a><div class="ex"> Execute a system command and transform output                                                                                            </div>

 puts `tasklist`.<b>gsub</b>(/\w+.exe/) { |exp|  exp.<b>upcase</b>}

Nom de l'image                 PID Nom de la sessio Numéro de s Utilisation
========================= ======== ================ =========== ============
System Idle Process              0 Services            0        24 Ko
System                           4 Services            0    15 376 Ko
<b>SMSS.EXE</b>                  376 Services          0     1 420 Ko
<b>CSRSS.EXE</b>                 544 Services          0     6 124 Ko
. . . 
<a name="c27"></a><div class="c"> defines a function, a method                                                                                           </div>

def a(x,y)
  puts "You gave me #{ x } and #{ y }"
end
def b(x,y)  puts("You gave me #{ x } and #{ y }") end

a( "apple", "banana")

class A
  def method(a,b)
  end
end
A.new().method(1,2)
# or
A.new.method 1,2

<a name="c28"></a><div class="c1"> Arguments                                                                                            </div>

def a(a,b,c) end ; a(1,2,3)
def a(a,b,*c) end ; a(1,2,3,4,5,6)            # =&gt; c=[3,4,5,6]
def a(a,b=nil,*c) p [a,b,c] ; end ; a(1)      # [1,nil,[]]
def a(options) p options ; end ; a(x: 1,y: 2) # {:x=&gt;1, :y=&gt;2}

def a(opt) p [opt,yield] end ; a(x: 11) { p 22 } 
# 22
# [{:x=&gt;11}, 22]

<a name="c29"></a><div class="c"> BLOCK                                                                                            </div>

<a name="c30"></a><div class="c1"> block parameter/yield                                                                                            </div>
 def evaluate()
   print "Evaluate give: "
   yield #!!!! here, the bloc is executed
   puts "done"
 end
 evaluate { p 'CouCou' }
 Evaluate give: "CouCou"
 done
 
 # test if a bloc is in parameter list : block_given?

 def transform_and_add(*args)
   args=args.map { |a| yield(a)}  if <b>block_given?</b>
   args.inject(0) { |a,v| a+v }
 end
 transform_and_add(2,3,4) { |i| i**3}
 
<a name="c31"></a> <div class="c1"> explicit block parameter/explicit call                                                                                           </div>
 def e1(&amp;blk) print "e1:" ; &amp;blk.call(1) end
 def e2(&amp;blk) print "e2:" ; &amp;blk.call(2) end
 def evaluate(&amp;bloc)
   if true
     e1(&amp;bloc) 
   else
     e2(&amp;bloc)
 end
 evaluate { p 'CouCou' }

<a name="c32"></a><div class="c1"> block object / block call                                                                                            </div>
def ifthenelse(options)
  if options[:condition].call
    options[:then_code].call
  else
    options[:else_code].call
  end
end

ifthenelse({
  condition: proc { (Time.now.to_i % 2) == 0},
  then_code: proc { p "Ok"},
  else_code: proc { p "NOk"}   
})


<a name="c33"></a><div class="c"> conditionally with an if (or unless) statement                                                                                           </div>
<a name="c34"></a><div class="c1"> simple if                                                                                           </div>

if false
  # this won't happen
elsif nil
  # this won't either
else
  # code here will run though
end

unless false
  # this won't happen
else
  # code here will run though
end

<a name="c35"></a><div class="c1"> postfix if/unless (a la perl)                                                                                           </div>

p 'x'  if true
p 'y' unless true

def div(a,b)
  (p 'error';return(9999999)) if b.<b>abs</b>&lt;0.0000000001
  a/b
end

<a name="c36"></a><div class="c"> case statement                                                                                           </div>

x = "dog"
case x
when "fish"
 # this won't happen
when "dog", "cat", "monkey"
  # this will run
else
  # the else is an optional catch-all
end

# case X when Y  &lt;===&gt; if Y === X then
<table class="ccol"><tbody><tr>
<td>
if String === var
 code1
elsif (1..10) === var
 code2
elsif "eee"==var
 code3
else
 code4
end
</td><td>
case var
  when Sting
    code1
  when 1..10
    code2
  when "eee"
    code3
  else
    code4
end
</td></tr></tbody></table>
<a name="c37"></a><div class="c"> Looping                                                                                            </div>
<a name="c38"></a><div class="c1"> while statement                                                                                           </div>
 while true
  ...
 end
 do 
  ...
 while true
<a name="c39"></a><div class="c1"> until statement                                                                                           </div>
until false
  ..
end

do 
  ...
until true

<a name="c40"></a><div class="c1"> loop                                                                                            </div>

loop { p Time.<b>now</b>; sleep 1}
loop {
  break unless ...   # while form
  next if ...        # === continue
  ....
  break if ...       # until form
}
100.<b>times</b>  { |i| }
1.<b>upto</b>(10) { |i| }
10.<b>downto</b>(1) { |i| }
(1..100).<b>step</b>(2) { |i| }


<a name="c41"></a><div class="c"> Thread                                                                                            </div>
require 'thread'

th=Thread.new {
....
}
th=Thread.new(a,b,c) { |a1,b1,c1|
...
}
...
th.<b>alive</b>?() # test
th.<b>join</b>()   # wait thread is finish

ths=Dir.<b>glob</b>("*").<b>map</b> { |d| 
  Thread.<b>new</b>(d) {|d1| 
    trait(d1) if Dir.<b>exists</b>?(d1) 
  }.<b>compact</b>
ths.<b>each</b> {|th| th.<b>join</b>}

# !!!!! WARNING Array [] and Hash {} are not thread safe !!!!!

# use Queue in place of Array if the arrays shared between thread
# bug are not visible with MRI (Giant lock), 
# by are with IronRuby/JRuby use Monitor (mutex optimized)

require 'thread'
require 'monitor'

mon=Monitor.new
h={}
cpt=0
10.times do Thread.new do 10.times do
  mon.<b>synchronize</b> { h[cpt]=Time.now ; cpt+=1}
end end end

<a name="c42"></a><div class="c"> Catch Exceptions                                                                                            </div>

# with exception type selector

begin
  ...
rescue SocketException  =&gt; e
  ..
rescue IOError =&gt; e
  ..
else 
  .. (anonymous rescue) : code if not selected exception : Exception object is $!
ensure
  .. code always executed (==finally)
end

<a name="c43"></a><div class="c1"> Exception and  StandardError                                                                                            </div>

# All exception derives from <b>Exception</b> Class
# Main son of <b>Exception</b> is <b>StandardError</b>



Exception:
    NoMemoryError
    ScriptError:
          LoadError   (gem)
          SyntaxError
    SignalException
    fatal
    SystemExit
    StandardError:
        SystemStackError
        LocalJumpError
        IOError
        RegexpError
        ZeroDivisionError
        ThreadError
        SystemCallError
        SecurityError
        RuntimeError
        NameError
        RangeError
        IndexError
        ArgumentError
        TypeError

# anonymous rescue catch only StandardError class and sons
<h3><center>" A rescue clause without an explicit Exception 
 class will rescue all StandardErrors (and only those)."</center></h3>

begin
  begin
    eval(" def 23234() end") 
  rescue
    puts "Syntaxe error catched ?"
  end
rescue Exception =&gt; e
 puts "Syntaxe error catched by a 'rescue Exception =&gt; e' : Yes!"
end

# give:
Syntaxe error catched by a 'rescue Exception =&gt; e' : Yes!



<a name="c44"></a><div class="c1"> postfixe form                                                                                            </div>

f.close rescue nil
(s.close if s ) rescue nil
a=(f.gets rescue nil) || (g.gets rescue "") 

log.text=log.text+txt  rescue puts("ECHO " + txt.to_s)

# Syntaxe Error are not catches  :
eval(" def 23234() end")  rescue nil     # not work !!!
gem 'unknown_gem" rescue gem 'known_gem' # not work !!!

<a name="c45"></a><div class="c1">generate a exception                                                                                            </div>

raise "comment"

class MyException &lt; Exception ; end
raise MyException,"comment"

<a name="c46"></a><div class="c1"> Thread and exception                                                                                            </div>

# by default, untrapped Exception in thread kill 
# the thread, and say nothing..

# say to ruby to kill process, 
# with explanation, if uncatched exception occurs :

<b>Thread.abort_on_exception=true </b>

or, only for that thread:

<b>Thread.current.abort_on_exception=true </b>

# pretty print an exception trapped :
Thread.new {
 loop {
    begin
      ....
    rescue
      puts "#{ $! } : \n  #{ 
        $!.<b>backtrace</b>[0..10].<b>join</b>("\n  ")
      }"
    end
 }
}

<div class="ex">                                                                                            </div>

def parallele(nb,*args) 
  $queue_parallele=Queue.new unless defined?($queue_parallele)
  (sleep 0.1 while $queue_parallele.size&gt;([2,nb-3].max)) while $queue_parallele.size&gt; nb
  $queue_parallele &lt;&lt; 1
  Thread.new(args) do |a|
    begin
       yield(*a)
	 rescue
	   puts $!.to_s
	 ensure
	   $queue_parallele.pop
	 end
  end
end
def  wait_end_paralle
  return unless defined?($queue_parallele)
  sleep 0.1 while $queue_parallele.size&gt;0
end

hosts.each {|host| parallele(10,host) { |h| ssh(h,commande) } }

<a name="c47"></a><div class="c"> File / Directory access                                                                                            </div>
File('x.rb').<b>size</b>         # size un byte
File('x.rb').mtime        # date (seconds from epoch) of last modification
File('x.rb').<b>exists</b>?      # existence , file or link or fifi or dir...
Dir.<b>exists</b>?('s')          # directory existence

File.<b>basename</b>(filename)
File.<b>extname</b>(fileneme)     #    sss/sssss/s/ddddddddddd.rrr
filr.<b>dirname</b>(filename           ^dirname    ^basename  ^extname

def rec(dir)
  Dir.<b>glob</b>("#{ dir }/*").<b>each</b> do |name| 
    (Dir.<b>exists</b>?(name)) ? rec(name) : puts("%-80s | %d" % [name,File.<b>size</b>(name)/1024])
  end
end
./anar.rb                                                                        | 1
./ang/ang-9.13.0.gem                                                             | 227
./ang/bin/ang                                                                    | 0
./ang/CHANGELOG.txt                                                              | 2
. . . . . .

<a name="c48"></a><div class="c1"> File read                                                                                           </div>
content= IO.read(filename)
content=File.read(filename,"utf-8")
lines=File.read(filename).split(/\r?\n/)
open(filename,"rb") { |f| content=f.read }
open(filename,"rb") { |f| case f.gets 
    when /a/ then p 1 ;
    when /b/ then p 2 ;
    when nil then break;
 end 
}

IO.foreach("filename") {|x| puts "Line : ", x.chomp }

<a name="c49"></a><div class="c1"> File write                                                                                            </div>
open(filename,"w") { |f| f.write(content)         }
open(filename,"a") { |f| f.write("end-of-file\n") }

<a name="c50"></a><div class="c"> Execute process, get output                                                                                            </div>

system("ls","-l") # return exit status, output is loose

cmd="ls -l".split(/\s+/)
cmd &lt;&lt; "a filename with blanc chars.txt"
system(*cmd)

<a name="c51"></a><div class="c1"> get output                                                                                            </div>
`ls -l`.split(/\r?\n/).grep(/.rb/).each {|line| puts line}

IO.popen "ls -l" do |io|
  io.each {|line| puts line }
end

# if sub-process do stdout buffereing :
require 'pty'
PTY.spawn "some-command" do |r,w,p|
  loop { puts r.gets }
end
<a name="c52"></a><div class="c1"> get input for sending data to subprocess                                                                                           </div>

require 'open3'
include Open3
popen3('ruby', '-e', 'str=gets;puts("out="+str.upcase)') do
  |stdin, stdout, stderr|
  stdin.write("hello from parent")
  stdin.close_write
  stdout.read.split("\n").each do |line|
    puts "[parent] stdout: #{ line }"
  end
end
# =&gt; [parent] stdout: out=HELLO FROM PARENT

<a name="c53"></a><div class="c"> Socket                                                                                            </div>

require 'socket'
BasicSocket.do_not_reverse_lookup = true # !!!

<a name="c54"></a><div class="c1"> Socket TCP client                                                                                           </div>

begin
  socket = TCPSocket.new(host,port)
  socket.sync=true
rescue
  puts "not connected : " + $!.to_s
  exit
end

th=Thread.new(socket) {|s|
  b=""
  until s.closed?
    b=s.recv(64*1024)
    break if ! b || b.size==0
    print "!!!!!!!!!! "+ b + "!!!!!!"
    s.puts "Ok#{ b.size }"
  end
  puts "exited"
}
th.join
s4=Time.now
s.close rescue nil

<a name="c55"></a><div class="c1"> Socket TCP server                                                                                           </div>

class EchoServer &lt; GServer
  def serve( io )
    line="a"
    until io.closed? || line.length==0
      line = io.recv(1000)
      puts "Received: " + line.inspect
    end
  end
end
echo_server = EchoServer.new( 9999 ,"0.0.0.0",20 )
echo_server.start        # Start server
echo_server.join         # Prevent exiting while server is running

<a name="c56"></a><div class="c1"> Socket UDP Send and Receive                                                                                            </div>

client = UDPSocket.new
client.bind(host, port)
puts "Serve UDP on %s:%d" % [host,port]
loop do
  data, addr = client.recvfrom(1024) 
  puts "From addr: '%s', msg: '%s'" % [addr.join(' / '), data]
  client.send(data,0,addr.last,addr[1])
end

<a name="c57"></a><div class="c1"> Socket Multicast                                                                                            </div>
require 'socket'
require 'timeout'
require 'enumerator'
require 'ipaddr'

Thread.abort_on_exception=true
BasicSocket.do_not_reverse_lookup = true 


class MulticastEcho
  def initialize(ip,port)
    @ip,@port=[ip,port]
    "<b>";@addr = IPAddr.new(ip).hton + IPAddr.new("0.0.0.0").hton;"</b>"
    @bip=IPAddr.new(ip).hton
    version=0
    puts "Mutlticast on group " + ip + ":" + port.to_s + " ..."
    create_socket
    Thread.new {    
      sender
    }
    Thread.new {   loop { receiver } }
  end
  # create a socket binded to Multicast address, for receive datagramme
  def create_multicast_socket
      "<b>"
      @sock = UDPSocket.new
      @sock.bind(Socket::INADDR_ANY, @port) if File.exists?("c:/windows")
      @sock.setsockopt(Socket::IPPROTO_IP, Socket::IP_ADD_MEMBERSHIP, @addr)
      # LOOP:  \001 for receive self message, \000 else
      @sock.setsockopt(Socket::IPPROTO_IP, Socket::IP_MULTICAST_LOOP, "\001")	if defined?(Socket::IP_MULTICAST_LOOP)
      @sock.setsockopt(Socket::IPPROTO_IP, Socket::IP_MULTICAST_TTL, 3)        if defined?(Socket::IP_MULTICAST_TTL) 
      @sock.setsockopt(Socket::IPPROTO_IP, Socket::IP_TTL, 3)                  if defined?(Socket::IP_TTL) 
      @sock.bind(Socket::INADDR_ANY, @port) unless File.exists?("c:/windows")
      "</b>"
  end
  def receiver
      puts "waiting on #{ @sock }..."
      "<b>";mess, adr = @sock.recvmsg(1024);"</b>"
      puts "Received : #{ mess } from #{ adr.inspect }" if mess
  rescue Exception =&gt; e
    puts "Receiver Exception "+ $!.to_s
    @sock.close rescue nil
    exit(1)
  end
  
  # create a UDPsocket  not binded, and use it to send datagramme to a Multicast group
  def sender
      socket = UDPSocket.open ; 
      socket.setsockopt(Socket::IPPROTO_IP, Socket::IP_TTL, [1].pack('i'))
      sleep(0.3) ; 
      loop {   
        mess=Time.now.to_s
        puts "sending mc " + mess
        "<b>"; so.send(mess, 0, @ip , @port) ; "</b>"
        sleep 3
      }
  rescue Exception =&gt; e
    puts "Sender Exception "+ $!.to_s
    @sock.close rescue nil
    puts "Sender Exception "+ $!.to_s
  end 
end

MulticastEcho.new("230.1.1.1",9994)
sleep

<a name="c58"></a><div class="c"> Serialisation                                                                                            </div>

data=[{a:1,b:2,c:[1,2,3]},"eeeeeee",1.1]
File.open("data.conf","wb") { |f| Marshal.dump(data,f) }
File.open("data.conf","rb") { |f| data= Marshal.load(f) }

# do a real duplication 

data_cloned=Marshal.load(Marshal.dump(data))

# dup and clone are shallow  cloning

a=[1,[2,4]]
b=a.dup

b[1][0]=22
p a         # [1, [22, 4]]

b[0]=33
p a         # [1, [22, 4]]  ; unchanged !


<a name="c59"></a><div class="c"> Class                                                                                            </div>
class Myclass
  def initialize(a,b) @a=[a,b] end
  def doit()         p @a     end
end

a=Myclass.<b>new</b>(1,2)
a.<b>doit</b>()    #  [1,2]

class Myclass2 &lt; Myclass
  def initialize(a,b) @a=[a,b] end
  def doit2()         p @a*2  end
end

a=Myclass2.<b>new</b>(1,2)
a.<b>doit</b>()    #  [1,2]    (inherited)
a.<b>doit</b>2()   #  [1,2,1,2]

<a name="c60"></a><div class="c"> Module                                                                                            </div>
module Mymodule
  def minit(x)       @b=x+[111] end
  def doit()         p @a     end
  def doit_b()       p @b     end
end

class Myclass
  include Mymodule
  def initialize(a,b) @a=[a,b] ; minit(@a) end
end

a=Myclass.<b>new</b>(1,2)
a.<b>doit</b>()    #  [1,2]
a.<b>doit_b</b>()   #  [1,2,111]

<a name="c61"></a><div class="c"> Class : singleton, statics...                                                                                           </div>

class Myclass
  def initialize(a,b) @a=[a,b] ; end
  class &lt;&lt; self # define static resources
    X=222
    def x() X end
    def a() p 'c a'; end
    def b() p 'c b'; self.a() end
  end
  def a()
    p 'i a' ; self.class.a()
  end
end

&gt;&gt; a=Myclass.new(1,2)
&gt;&gt; a.a                 # "i a" ; "c a"
&gt;&gt; Myclass.a           # "c a"
&gt;&gt; Myclass.b           # "c b"  ; "c a"
&gt;&gt; Myclass.x           # 222


<a name="c62"></a><div class="c"> Introspection 1                                                                                           </div>
<a name="c63"></a><div class="c1"> Introspection 1 :level class                                                                                           </div>
class A
  def intialize() @a=1;@b=2 end
  def amethod() p instance_variables end
end

a= A.new
p a.methods                   
[:intialize, :amethod, :__, :a, :po, :poc, :pretty_print, 
:pretty_print_cycle, :pretty_print_instance_variables, 
:pretty_print_inspect, :nil?, :===, :=~, :!~, :eql?, 
:hash, &lt;=&gt;, :class, :singleton_class, :clone, :dup,
..........
:object_id, :to_enum, :enum_for, :gem_loaded, :pretty_inspect, 
:ri, :==, :equal?, :!, :!=, ....]

p (a.methods-Object.methods)  # [:intialize, :amethod]
p a.class                     # A
p a.instance_variables        # []
a.amethod

<a name="c64"></a><div class="c1">  Introspection 2 : level Instructions                                                                                           </div>

# AST from string code 

require 'ripper'         
p Ripper.sexp("a=1;b=2;a+b")


# Ruby source from ruby analysed code ; define .to_source

require 'sourcify'       
def bloc_source(a,&amp;blk)
   p blk.to_source
end 
bloc_source(1)   # "proc { a = 2 }"



<a name="c65"></a><div class="c"> Meta programming                                                                                           </div>
Meta x: x of x
Metaphysics: Physics of physics
Meta language : language which permit to describe language ( BNF )
Meta Programming: Instructions which generate instructions
                   Program which generate Program which resolve problems...

<a name="c66"></a><div class="ex">From a Hash, create a Class which each method gives access of members of the hash
                                                                                           </div>
<table class="ccol">
<tbody><tr><th> Definition</th><th> Usage</th></tr>
<tr><td>
<pre><code>
def hash_to_class(h)
  Class.new() {               # build a class
    def initialize(x=nil)     # define object constructor
      @values= {}
      self.def_init()
      @values= @values.merge(x) if x  
    end
    define_method(:def_init) { 
      h.each  { |key,value|  
        @values[key]=value   
    } }
    define_method(:keys) {  h.keys }   # define getters/setters 
    h.each do |key,value|
      define_method(key) { @values[key] }
      define_method("#{ key }=") { |x| @values[key]=x }   
    end
  }
end
</code></pre>
</td><td>
<pre><code>
C=hash_to_class({a: 11, b: 22})
o=C.new
p o.keys        # [:a,:b]
p o.a           # 11
p o.b           # 22
<hr>

o=C.new
o.a=1
o.b=2
p o.a          # 1
p o.b          # 2
<hr>

f=C.new({a:111,c:999})
p [f.a,f.b]    # [111,22]
f.c            # Error: Exception
</code></pre>
</td></tr></tbody></table>

<a name="c67"></a><div class="c"> DSL with Ruby Bloc                                                                                           </div>

<a name="c68"></a><div class="ex"> Define a micro-test framework                                                                                            </div>

<table class="ccol">
<tbody><tr><th>DSL Definition</th><th>DSL Usage</th></tr>
<tr><td>
<pre><code>
class Test
  class &lt;&lt; self
    def program(&amp;blk) 
      Test.new.instance_eval(&amp;blk) 
    end
  end
  
  def ressource(method,http,descr)
   @descr=descr
   puts "Starting '#{ @descr }' ..."
   yield
   puts "done, OK"
  end
  
  def test(comment)
   @comment=comment
   begin
   yield
    puts "  #{ @comment } ok" 
   rescue
    puts "Error on #{ comment }: #{ $! }"
   end
  end
  
  def body() @comment end
  
  def assert(&amp;blk)
    pp=yield  
    raise("fault ") unless pp
  end
end
</code></pre>
</td><td>
<pre><code>
Test.program do
  ressource "GET","http://localhost:9990/test","autotest" do
    test("testA with error") do
      assert { body.size&gt;0 }
      assert { body.size&gt;100 }
      assert { body.size&gt;0 }
      assert { body.size&lt;0 }
    end
    test("testB1 without error") do
      assert { body.size&gt;0 }
    end
    test("testC with error") do
      assert { body.size&lt;0 }
    end
  end
end
<hr>
Starting 'autotest' ...
Error on testA with error: fault
  testB1 without error ok
Error on testC with error: fault
done, OK

See jsontester gem for the complete DSL.

</code></pre>
</td></tr></tbody></table>

<a name="c69"></a><div class="c"> Ruby and Functional Programming                                                                                            </div>
<a name="c70"></a><div class="c1"> Principles                                                                                            </div>
(From http://code.google.com/p/tokland/wiki/RubyFunctionalProgramming)

Critics
========

"I think the lack of reusability comes in object-oriented languages, 
not in functional languages. Because the problem with object-oriented 
Languages is they’ve got all this implicit environment that they carry
around with them. You wanted a banana but what you got was a gorilla 
holding the banana and the entire jungle." 

Principles
=========
"Don't update variables : smake a new one"
=&gt; So don't use bang methodes : methodes!()
=&gt; less variable mean less state mean less bug &amp; less concurrent access issue

"Blocks as higher order functions"
=&gt; name the block, give block to treatment, as data


"Pure functional languages, having no implicit state, use recursion a lot."
=&gt; Recursion minimize variable rewriting, 
=&gt; Warning, Ruby do not optimize tail recursion

"Lazy evaluation delays the evaluation of the expression until it's needed, 
as opposed to eager evaluation, where expressions are calculated when a 
variable is assigned, a function called"
=&gt; Lazy evaluation is new in ruby

<a name="c71"></a><div class="c1"> Closure                                                                                                                               </div>

a=1 ; 1.times { a=2 ;p a} ; p a  # 2 ; 2
x=1 ; 1.times { a=2 ;p a} ; p a  # 2 ; Exception unknown variable 'a'

# A bloc in ruby is exactly the same as bloc in C : variables scoping
# follow same rules.

# but blocs are closures : we can manipulate them, (almost) as data.
so 'times' method can be redefined by :

class Numeric
  def mtimes()
    c=0
    while c &lt; self
      yield(c)
      c+=1
    end
  end
end

<b># Remember : 'while' (as' if', 'case' ...) is not a closure, variable defined 
# will exist outside looping
</b>

<div class="c1"><a name="array2"></a> Array 2                                                                                            </div>
(from http://www.pracht.org/dokuwiki/prog/algo1/cm4 )

[2,4,6].<b>all</b>? { |e| (e % 2) == 0 } # =&gt; true
[2,5,6].<b>all</b>? { |e| (e % 2) == 0 } # =&gt; false

[2,5,6].<b>any</b>? { |e| (e % 2) == 1 } # =&gt; true
[2,4,6].<b>any</b>? { |e| (e % 2) == 1 } # =&gt; false

[2,4,6].<b>include</b>?(4) # =&gt; true
[2,5,6].<b>include</b>?(4) # =&gt; false


['un','deux','trois','quatre'].<b>each_with_index</b> do |nom, indice|
  puts("le nom est '#{ nom }'")
  puts("pour l'indice: #{ chiffre }")
end

[1,2,3,4,5].<b>each_cons</b>(2) { |a,b| p [a,b] }   # [1, 2] [2, 3] [3, 4] [4, 5]
[1,2,3,4,5].<b>each_slice</b>(2) { |a,b| p [a,b] }  # [1, 2] [3, 4] [5, nil]

[1,2,3].<b>zip</b>([101,102,103]) { |a,b| p [a,b] } # [1, 101] [2, 102] [3, 103]
 %w.<b>zip</b>(%w) { |a,b| puts a+","+b }
Romeo,Juliette
Bonie,Clyde
Dupond,Dupont


[2,4,6].<b>inject</b>(0) {|somme, n| somme + n } # =&gt; 12
[2,4,6].<b>inject</b>(1) {|produit, n| produit * n } # =&gt; 48

(2..6).<b>to_a</b> # =&gt; [2, 3, 4, 5, 6]

[2,4,6].<b>collect</b> { |e| e * 2 } # =&gt; [4, 8, 12]
[2,4,6].<b>map</b>     { |e| e * 2 } # =&gt; [4, 8, 12]

[2,5,6].<b>find_all</b> { |e| (e % 2) == 0 } # =&gt; [2, 6]
[2,5,6].<b>reject</b> { |e| (e % 2) == 0 } # =&gt; [5]
["Pierre", "Paul", "Jacques", "Alain"].<b>grep</b>(/a/)  # =&gt; ["Paul", "Jacques", "Alain"]

(0..14).<b>partition</b> { |e| (e % 3) == 0 }; "" # =&gt; 
    [
      [0, 3, 6, 9, 12], 
      [1, 2, 4, 5, 7, 8, 10, 11, 13, 14]
    ]


w.group_by {|lang| lang[0] } #  =&gt; {
  "j"=&gt;["java"], "p"=&gt;["perl", "python"], "r"=&gt;["ruby"]}


[2,4,6].<b>max</b> # =&gt; 6
[2,4,6].<b>min</b> # =&gt; 2
[2,16,6].<b>minmax</b> # =&gt; [2,16]

["Pi", "Pa", "Ja", "Al"].<b>sort</b> { |a, b| b &lt;=&gt; a }# =&gt; ["Pi", "Pa", "Ja", "Al"]
["Pi", "Pa", "Ja", "Al"].<b>sort</b> { |a, b| a &lt;=&gt; b }# =&gt; ["Al", "Ja", "Pa", "Pi"]

["Pi", "Pa", "Ja", "Al"].<b>sort_by</b> { |e| e.<b>reverse</b> } # =&gt; ["Ja", "Pa", "Pi", "Al"]

<a name="c72"></a><div class="c1"> Examples from  onliner classical code                                                                                            </div>
<a name="c73"></a><div class="ex"> print methods which match a regexp of an object                                                                                            </div>

puts (self.methods - Object.methods)
      .sort
      .select {|s| s=~filter}
      .map { |e| "%-15s" % [e]}.join("\n")

paths = ARGV.select { |f|  
      f !~ /^-\\w+/ &amp;&amp; File.exists?(f) &amp;&amp;  File.directory?(f) 
}.map {|d| d.gsub(/(\\/)|(\\\\)$/,\"\")}.uniq


<a name="c74"></a><div class="ex"> print big line of ruby code in current directory                                                                                           </div>
Dir.glob("*.rb").each do |filename|
  File.read(filename)
  .split(/r?\n/)
  .select {|l|  l.size&gt;100 &amp;&amp; l !~ /\\n/ &amp;&amp; l=~/(map)|(sort)/}
  .each {|l|puts "%-20s | %s" % [filename,l]}
end

<a name="c75"></a><div class="ex"> rotation of a polyline                                                                                           </div>

def rotation(a=180,x0=0,y0=0)
  @lpoints.map { |(x,y)| [
     x0+(x-x0)*Math.cos(a)+(y-y0)*Math.sin(a),
     y0-(x-x0)*Math.sin(a)+(y-y0)*Math.cos(a)
   ] 
  }
end
<a name="c76"></a><div class="c"> Source code sructure                                                                                           </div>

<a name="c77"></a><div class="ex"> includes                                                                                            </div>

require './toto.rb'  # load a local file in current directory, old style
require_relative 'aa/x.rb' # pretty form for load local file

require 'toto'      # load a package (gem) name 'toto', 
                    # gems are in one directory of $:
                    
$: &lt;&lt; "."     # local dir become a gem directory: 
require 'titi'      # file titi.rb is loading, because . is in load path!

<a name="c78"></a><div class="ex"> context : where is current instructions?                                                                                            </div>

a=1                 # instruction, in context of object 'main'
p self              # main
p self.class        # Object
def a() ; end       # append a method to Object : 
                    #   methode is known by everybody

<a name="c79"></a><div class="ex"> class scope                                                                                           </div>

class A             # create a class in Oject namespace :
                    #  class A is known by everybody 
end

class B
  class BA          # BA is known as ::B::BA
  end
  BA.new            # BA known in context of B
end

B.new
::B::BA.new         # BA known only in B spacename

<a name="c80"></a><div class="ex"> Here docs                                                                                           </div>

Thread.new {
  p DATA.read                # DATA is a stream of the DATA section of current source
  p (DATA.read rescue "nop") # bug: DATA can be read only one time
}

# Here doc : string literal can be multilines
#   "" form

html=&lt;&lt;EEND
&lt;html&gt;&lt;head&gt;&lt;title&gt;#{ title }&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;#{ title }&lt;/h1&gt;#{ content }&lt;/body&gt;
EEND

# '' from : #{} are not evaluated

html=&lt;&lt;'EEND'
&lt;html&gt;&lt;head&gt;&lt;title&gt;#{ title }&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;#{ title }&lt;/h1&gt;#{ content }&lt;/body&gt;
EEND
html.gsub(/title/,"Title")

a=calledproc(&lt;&lt;EEND1,&lt;&lt;EEND2)
content of first parameter #{ data }
EEND1
content of second parameter #{ data }
EEND2

<a name="c81"></a><div class="ex"> source here doc                                                                                            </div>
# end source section, starting DATA section, 
# each source can have a data sections : 
# puts html template, css declaraions, output instructions / Usage...

__END__
blabla 
boubou

<hr>

<a name="c82"></a><div class="c"> the end...                                                                                           </div>

</code></pre>
<ul>
ToDo:
<ul>
<li>enumerator, conjonction, lazy
</li><li>pack/unpack
</li><li> Class stuff....
</li><li>some internet docs references
</li></ul>
Objective:
<ul><b>On each category give some snipetts which are pertinent and useful</b></ul>
</ul>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25105685-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script> 

</body></html>